import {Component, EventEmitter, Input, OnInit, Output} from '@angular/core';
import {StepResource} from "../../../models/step-resource";
import {StepResourceService} from "../../../services/step-resource.service";
import {StepService} from "../../../services/step.service";
import {ImageViewerComponent} from "../../../shared/image-viewer/image-viewer.component";
import {MatDialog} from "@angular/material/dialog";

@Component({
  selector: 'app-step-resource',
  templateUrl: './step-resource.component.html',
  styleUrl: './step-resource.component.css'
})
export class StepResourceComponent implements OnInit{
  @Input() stepId: number|undefined =0;
  resources:StepResource[]|undefined=[];
constructor(private service:StepResourceService,private stepService:StepService,private dialog: MatDialog) {
}
  copyToClipboard(content: string | undefined): void {
    if (typeof content === "string") {
      navigator.clipboard.writeText(content).then(() => {
        console.log('Copied to clipboard');
      });
    }
  }

  deleteResource(resource: StepResource): void {
    this.service.delete(resource.id!).subscribe(() => {
      this.loadResources(); // Reload steps after deletion
    });
  }

  private loadResources() {
    this.stepService.getById(this.stepId).subscribe((data) => {
      this.resources=data.resources;
    });
  }

  ngOnInit(): void {
  this.loadResources();
  }

  getFileNameFromPath(path: string | undefined): string {
    if (path)
      return path.split('/').pop() || path;
    return '';
  }

  openImageViewer(imageUrl: string): void {
    this.dialog.open(ImageViewerComponent, {
      data: { imageSrc: imageUrl },
      panelClass: 'custom-dialog-container'
    });
  }
}
