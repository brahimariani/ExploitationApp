import {Component, Inject} from '@angular/core';
import {FormBuilder, FormGroup, Validators} from "@angular/forms";
import {GroupService} from "../../../services/group.service";
import {MAT_DIALOG_DATA, MatDialogRef} from "@angular/material/dialog";
import {Group} from "../../../models/group";
import {Procedure} from "../../../models/procedure";
import {StepService} from "../../../services/step.service";
import {Step} from "../../../models/step";

@Component({
  selector: 'app-step-create',
  templateUrl: './step-create.component.html',
  styleUrl: './step-create.component.css'
})
export class StepCreateComponent {
  groupForm: FormGroup;
  item:Step;

  constructor(
    private fb: FormBuilder,
    private service: StepService,
    @Inject(MAT_DIALOG_DATA) public data: Procedure,
    private dialogRef: MatDialogRef<StepCreateComponent>
  ) {
    this.item = {
      title: '',
      position: (this.data.steps?.length || 0) + 1,
      procedureId: this.data.id
    }
    console.log("from constructor:"+this.data.id)
    this.groupForm = this.fb.group({
      title: ['', Validators.required]
    });

  }

  onSubmit(): void {
    if (this.groupForm.valid) {

      if (this.item) {
        this.item.title=this.groupForm.value.title;

        this.service.create(this.item).subscribe({
          next: (result) => {
            this.dialogRef.close(result);
          },
          error: (err) => console.error('Failed to create Step', err)
        });
      } else {
        console.error("Step is not initialized.");
      }
    }
  }


  onCancel(): void {
    this.dialogRef.close();
  }
}
